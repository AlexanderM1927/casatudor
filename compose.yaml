version: "3.5"
services:
  frontend:
    container_name: frontend_containter
    image: node:20-alpine
    build: ./nuxt
    volumes:
      - ./nuxt:/usr/src/nuxt-app
    networks:
      - frontend
    ports:
      - "3000:3000"

  backend:
    container_name: strapi
    build: ./strapi
    image: strapi:latest
    env_file: ./strapi/.env
    volumes:
      - ./strapi/config:/opt/app/config
      - ./strapi/src:/opt/app/src
      - ./strapi/package.json:/opt/package.json
      - ./strapi/yarn.lock:/opt/yarn.lock
      - ./strapi/.env:/opt/app/.env
      - ./strapi/public/uploads:/opt/app/public/uploads
    ports:
      - "1337:1337"
    networks:
      - strapi

  # Nginx
  casatudor_nginx:
    image: nginx:alpine
    container_name: casatudor_nginx
    restart: always
    volumes:
      - ./strapi:/opt/app
      - ./nuxt:/usr/src/nuxt-app
      - ./config/nginx/conf.d:/etc/nginx/conf.d
      - ./config/nginx/certs:/etc/nginx/certs
    depends_on:
      - frontend
      - backend
    networks:
      network_casatudor:
        aliases:
          - casatudor.localhost

networks:
  strapi: {}
  frontend: {}
  network_casatudor:
    name: network_casatudor