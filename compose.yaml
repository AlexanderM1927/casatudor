version: "3.5"
services:
  frontend:
    container_name: frontend_containter
    image: node:20-alpine
    build: 
      dockerfile: Dockerfile
      context: ./nuxt
    volumes:
      - ./nuxt:/usr/src/nuxt-app
    ports:
      - "3000:3000"
    networks:
      - network_casatudor

  backend:
    container_name: strapi
    image: strapi:latest
    build: 
      dockerfile: Dockerfile
      context: ./strapi
    env_file: ./strapi/.env
    volumes:
      - ./strapi/config:/opt/app/config
      - ./strapi/src:/opt/app/src
      - ./strapi/package.json:/opt/package.json
      - ./strapi/yarn.lock:/opt/yarn.lock
      - ./strapi/.env:/opt/app/.env
      - ./strapi/public/uploads:/opt/app/public/uploads
    ports:
      - "1337:1337"
    networks:
      - network_casatudor

  # Nginx
  casatudor_nginx:
    image: nginx:alpine
    container_name: casatudor_nginx
    restart: always
    volumes:
      - ./strapi:/opt/app
      - ./nuxt:/usr/src/nuxt-app
      - ./config/nginx/conf.d:/etc/nginx/conf.d
      - ./config/nginx/certs:/etc/nginx/certs
    depends_on:
      - frontend
      - backend
    networks:
      - network_casatudor

networks:
  network_casatudor: {}